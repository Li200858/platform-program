# 测试重新部署后文件不丢失

## 测试步骤

### 1. 上传测试文件
```bash
node test-simple.js
```
这会：
- 创建一个测试文件
- 上传到服务器
- 验证文件可以访问
- 保存测试信息到 `test-info.json`

### 2. 重新部署应用
在Render控制台中：
1. 点击 "Manual Deploy" 按钮
2. 选择 "Deploy latest commit"
3. 等待部署完成

### 3. 验证文件是否仍然存在
```bash
node test-verify.js
```
这会：
- 读取之前保存的测试信息
- 尝试访问测试文件
- 验证文件内容和完整性

## 预期结果

### ✅ 成功情况
```
✅ 文件仍然可以访问！
📄 当前文件内容: 测试文件内容 - 2025-09-22T05:45:34.611Z
🎉 文件内容完全一致！
✅ 重新部署后文件没有丢失！
```

### ❌ 失败情况
```
❌ 文件不存在 (404)
💡 可能的原因:
   1. 持久化存储未正确配置
   2. 文件路径配置错误
   3. 服务器重启时文件被清理
```

## 故障排除

### 如果文件丢失了：

1. **检查Render磁盘配置**：
   - 确认磁盘已正确挂载到 `/opt/render/project/src/uploads`
   - 检查磁盘大小是否足够

2. **检查服务器日志**：
   - 在Render控制台查看 "Logs"
   - 查找文件路径相关的错误信息

3. **检查代码配置**：
   - 确认 `uploadsDir` 变量设置正确
   - 验证静态文件服务配置

### 如果测试脚本失败：

1. **确保服务器正在运行**：
   ```bash
   node server/index.js
   ```

2. **检查端口是否正确**：
   - 默认端口是 5000
   - 如果端口不同，修改测试脚本中的端口号

3. **检查网络连接**：
   - 确保可以访问 `http://localhost:5000`

## 完整测试流程

```bash
# 1. 启动服务器
node server/index.js

# 2. 在另一个终端运行测试
node test-simple.js

# 3. 重新部署应用（在Render控制台）

# 4. 验证文件是否仍然存在
node test-verify.js
```

## 注意事项

- 测试文件会在测试完成后自动清理
- 测试信息保存在 `test-info.json` 中
- 如果测试失败，检查服务器日志获取更多信息
- 确保Render磁盘配置正确
