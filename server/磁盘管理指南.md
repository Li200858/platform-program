# ç£ç›˜ç®¡ç†æŒ‡å—

## ğŸ“Š **å½“å‰åˆ é™¤åŠŸèƒ½çŠ¶æ€**

### âœ… **ä¼šè‡ªåŠ¨åˆ é™¤ç£ç›˜æ–‡ä»¶çš„åŠŸèƒ½**

| åŠŸèƒ½ | API | åˆ é™¤å†…å®¹ | çŠ¶æ€ |
|------|-----|---------|------|
| åˆ é™¤è‰ºæœ¯ä½œå“ | `DELETE /api/art/:id` | âœ… æ‰€æœ‰mediaæ–‡ä»¶ | æ­£å¸¸ |
| åˆ é™¤æ´»åŠ¨ | `DELETE /api/activities/:id` | âœ… image + mediaæ–‡ä»¶ | æ­£å¸¸ |
| åˆ é™¤èµ„æ–™åº“ | `DELETE /api/resources/:id` | âœ… æ‰€æœ‰files | æ­£å¸¸ |
| åˆ é™¤ä½œå“é›† | `DELETE /api/portfolio/:id` | âœ… coverImage | æ­£å¸¸ |
| **åˆ é™¤ä½œå“é›†å†…å®¹** | `DELETE /api/portfolio/:id/contents/:contentId` | âœ… æ‰€æœ‰mediaæ–‡ä»¶ | **æ–°å¢** |
| **åˆ é™¤åé¦ˆ** | `DELETE /api/feedback/:id` | âœ… æ‰€æœ‰mediaæ–‡ä»¶ | **æ–°å¢** |

---

## ğŸ§¹ **å¦‚ä½•æ¸…ç†å­¤ç«‹æ–‡ä»¶**

### **æ–¹æ³•1ï¼šè‡ªåŠ¨æ£€æµ‹å’Œæ¸…ç†ï¼ˆæ¨èï¼‰**

#### **æ­¥éª¤1ï¼šæ£€æŸ¥å­¤ç«‹æ–‡ä»¶**
```bash
cd server
node cleanup-orphaned-files.js
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
========================================
å¼€å§‹æ¸…ç†å­¤ç«‹æ–‡ä»¶...
ä¸Šä¼ ç›®å½•: /path/to/uploads
========================================

ç£ç›˜æ–‡ä»¶æ€»æ•°: 150

æ£€æŸ¥è‰ºæœ¯ä½œå“ä¸­çš„æ–‡ä»¶å¼•ç”¨...
  è‰ºæœ¯ä½œå“å¼•ç”¨æ–‡ä»¶: 45 ä¸ª
æ£€æŸ¥æ´»åŠ¨ä¸­çš„æ–‡ä»¶å¼•ç”¨...
  æ´»åŠ¨å¼•ç”¨æ–‡ä»¶: 58 ä¸ªï¼ˆç´¯è®¡ï¼‰
æ£€æŸ¥åé¦ˆä¸­çš„æ–‡ä»¶å¼•ç”¨...
  åé¦ˆå¼•ç”¨æ–‡ä»¶: 62 ä¸ªï¼ˆç´¯è®¡ï¼‰
æ£€æŸ¥ä½œå“é›†ä¸­çš„æ–‡ä»¶å¼•ç”¨...
  ä½œå“é›†å¼•ç”¨æ–‡ä»¶: 75 ä¸ªï¼ˆç´¯è®¡ï¼‰
æ£€æŸ¥èµ„æ–™åº“ä¸­çš„æ–‡ä»¶å¼•ç”¨...
  èµ„æ–™åº“å¼•ç”¨æ–‡ä»¶: 120 ä¸ªï¼ˆç´¯è®¡ï¼‰

æ•°æ®åº“ä¸­å¼•ç”¨çš„æ–‡ä»¶æ€»æ•°: 120

å‘ç° 30 ä¸ªå­¤ç«‹æ–‡ä»¶

å­¤ç«‹æ–‡ä»¶åˆ—è¡¨:
  1. 1696123456789-123456789.png (2.45 MB)
  2. 1696234567890-987654321.mp4 (15.32 MB)
  ...

å­¤ç«‹æ–‡ä»¶æ€»å¤§å°: 125.67 MB

========================================
æ˜¯å¦åˆ é™¤è¿™äº›å­¤ç«‹æ–‡ä»¶ï¼Ÿ
è¿è¡Œå‘½ä»¤: node cleanup-orphaned-files.js --delete
========================================
```

#### **æ­¥éª¤2ï¼šåˆ é™¤å­¤ç«‹æ–‡ä»¶**
```bash
node cleanup-orphaned-files.js --delete
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
å¼€å§‹åˆ é™¤å­¤ç«‹æ–‡ä»¶...

âœ… å·²åˆ é™¤: 1696123456789-123456789.png
âœ… å·²åˆ é™¤: 1696234567890-987654321.mp4
...

åˆ é™¤å®Œæˆï¼æˆåŠŸåˆ é™¤ 30/30 ä¸ªæ–‡ä»¶
é‡Šæ”¾ç©ºé—´: 125.67 MB
```

---

### **æ–¹æ³•2ï¼šæ‰‹åŠ¨æ¸…ç†**

#### **æŸ¥çœ‹uploadsç›®å½•**
```bash
cd server/uploads
ls -lh
```

#### **æŸ¥çœ‹æ–‡ä»¶å¤§å°**
```bash
du -sh *
```

#### **æ‰‹åŠ¨åˆ é™¤ç‰¹å®šæ–‡ä»¶**
```bash
rm 1696123456789-123456789.png
```

---

## ğŸ’¾ **å¦‚ä½•å¤‡ä»½ç£ç›˜æ•°æ®**

### **æ–¹æ³•1ï¼šä½¿ç”¨å¤‡ä»½è„šæœ¬ï¼ˆæ¨èï¼‰**

```bash
cd server
./backup-uploads.sh
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
========================================
å¼€å§‹å¤‡ä»½ä¸Šä¼ æ–‡ä»¶...
========================================

ä¸Šä¼ ç›®å½•: ./uploads
å¤‡ä»½ç›®å½•: ./backups/uploads/backup_20251012_143025

æ–‡ä»¶æ•°é‡: 120
æ€»å¤§å°: 2.3G

å¼€å§‹å¤åˆ¶æ–‡ä»¶...
âœ… å¤‡ä»½æˆåŠŸï¼

å¤‡ä»½ä½ç½®: ./backups/uploads/backup_20251012_143025
å¤‡ä»½ä¿¡æ¯å·²ä¿å­˜åˆ°: ./backups/uploads/backup_20251012_143025/backup_info.txt

æœ€è¿‘çš„å¤‡ä»½åˆ—è¡¨:
drwxr-xr-x backup_20251012_143025
drwxr-xr-x backup_20251011_120000
drwxr-xr-x backup_20251010_093015

========================================
å¤‡ä»½å®Œæˆï¼
========================================
```

**å¤‡ä»½å­˜å‚¨ä½ç½®ï¼š**
```
server/backups/uploads/
â”œâ”€â”€ backup_20251012_143025/
â”‚   â”œâ”€â”€ backup_info.txt
â”‚   â”œâ”€â”€ 1696123456789-123456789.png
â”‚   â”œâ”€â”€ 1696234567890-987654321.mp4
â”‚   â””â”€â”€ ...
â”œâ”€â”€ backup_20251011_120000/
â””â”€â”€ backup_20251010_093015/
```

---

### **æ–¹æ³•2ï¼šæ‰‹åŠ¨å¤‡ä»½**

#### **å®Œæ•´å¤‡ä»½**
```bash
cd server
cp -R uploads backups/uploads_$(date +%Y%m%d_%H%M%S)
```

#### **å‹ç¼©å¤‡ä»½ï¼ˆèŠ‚çœç©ºé—´ï¼‰**
```bash
cd server
tar -czf backups/uploads_$(date +%Y%m%d_%H%M%S).tar.gz uploads/
```

#### **æŸ¥çœ‹å¤‡ä»½**
```bash
ls -lh backups/
```

---

### **æ–¹æ³•3ï¼šå®šæœŸè‡ªåŠ¨å¤‡ä»½**

#### **åˆ›å»ºcronä»»åŠ¡ï¼ˆæ¯å¤©å‡Œæ™¨3ç‚¹å¤‡ä»½ï¼‰**
```bash
crontab -e
```

æ·»åŠ ä»¥ä¸‹è¡Œï¼š
```
0 3 * * * cd /path/to/server && ./backup-uploads.sh
```

---

## ğŸ”„ **æ¢å¤å¤‡ä»½**

### **ä»å¤‡ä»½æ¢å¤**
```bash
cd server
cp -R backups/uploads/backup_20251012_143025/* uploads/
```

### **ä»å‹ç¼©åŒ…æ¢å¤**
```bash
cd server
tar -xzf backups/uploads_20251012_143025.tar.gz
```

---

## ğŸ“ˆ **ç£ç›˜ä½¿ç”¨ç›‘æ§**

### **æŸ¥çœ‹uploadsç›®å½•å¤§å°**
```bash
cd server
du -sh uploads/
```

### **æŸ¥çœ‹å•ä¸ªæ–‡ä»¶å¤§å°**
```bash
cd server/uploads
ls -lh | sort -k5 -hr | head -20
```

### **ç»Ÿè®¡æ–‡ä»¶ç±»å‹**
```bash
cd server/uploads
find . -type f | sed 's/.*\.//' | sort | uniq -c | sort -nr
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
  45 png
  32 jpg
  15 mp4
  12 pdf
  10 docx
   6 xlsx
```

---

## âš ï¸ **æ³¨æ„äº‹é¡¹**

### **æ¸…ç†å­¤ç«‹æ–‡ä»¶å‰ï¼š**
1. âœ… å…ˆè¿è¡Œæ£€æŸ¥å‘½ä»¤ï¼ˆä¸åŠ --deleteå‚æ•°ï¼‰
2. âœ… ç¡®è®¤åˆ—å‡ºçš„æ–‡ä»¶ç¡®å®æ˜¯å­¤ç«‹çš„
3. âœ… è€ƒè™‘å…ˆå¤‡ä»½ï¼ˆä»¥é˜²è¯¯åˆ ï¼‰
4. âœ… å†è¿è¡Œåˆ é™¤å‘½ä»¤ï¼ˆåŠ --deleteå‚æ•°ï¼‰

### **å¤‡ä»½å»ºè®®ï¼š**
1. âœ… å®šæœŸå¤‡ä»½ï¼ˆå»ºè®®æ¯å‘¨ä¸€æ¬¡ï¼‰
2. âœ… ä¿ç•™è‡³å°‘3ä¸ªå¤‡ä»½
3. âœ… å‹ç¼©å¤‡ä»½ä»¥èŠ‚çœç©ºé—´
4. âœ… é‡è¦æ•°æ®å¼‚åœ°å¤‡ä»½

### **Renderéƒ¨ç½²ç‰¹åˆ«æ³¨æ„ï¼š**
âš ï¸ Renderå…è´¹ç‰ˆä¼šå®šæœŸé‡ç½®ç£ç›˜ï¼Œæ‰€ä»¥ï¼š
- uploadsç›®å½•ä¼šä¸¢å¤±
- å»ºè®®ä½¿ç”¨äº‘å­˜å‚¨ï¼ˆå¦‚Cloudinaryã€AWS S3ï¼‰
- æˆ–å‡çº§åˆ°ä»˜è´¹ç‰ˆè·å¾—æŒä¹…åŒ–å­˜å‚¨

---

## ğŸš€ **å¿«é€Ÿå‘½ä»¤å‚è€ƒ**

```bash
# æ£€æŸ¥å­¤ç«‹æ–‡ä»¶
node cleanup-orphaned-files.js

# åˆ é™¤å­¤ç«‹æ–‡ä»¶
node cleanup-orphaned-files.js --delete

# å¤‡ä»½ä¸Šä¼ æ–‡ä»¶
./backup-uploads.sh

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
du -sh uploads/

# æŸ¥çœ‹å¤‡ä»½åˆ—è¡¨
ls -lh backups/uploads/
```

---

## ğŸ’¡ **æœ€ä½³å®è·µ**

1. **å®šæœŸæ£€æŸ¥ï¼ˆæ¯æœˆï¼‰**
   ```bash
   node cleanup-orphaned-files.js
   ```

2. **å®šæœŸå¤‡ä»½ï¼ˆæ¯å‘¨ï¼‰**
   ```bash
   ./backup-uploads.sh
   ```

3. **åˆ é™¤å‰å¤‡ä»½**
   ```bash
   ./backup-uploads.sh
   node cleanup-orphaned-files.js --delete
   ```

4. **ç›‘æ§ç£ç›˜ä½¿ç”¨**
   ```bash
   du -sh uploads/
   ```

