# 📁 校园艺术平台 - 数据存储说明

## 🗂️ 存储架构

### 1. 用户上传文件存储
- **存储位置**: `server/uploads/` 目录
- **文件类型**: 图片、视频、文档等
- **命名规则**: `时间戳-随机数.扩展名`
- **访问方式**: `http://localhost:5000/uploads/文件名`

### 2. 用户个人数据存储
- **存储位置**: MongoDB 数据库
- **数据类型**: 用户信息、作品数据、互动数据
- **访问方式**: 通过后端 API

## 📊 存储详情

### 文件存储
```
server/uploads/
├── 1758508367722-273168292.png    # 用户上传的图片
├── 1758506478085-659248909.mp4    # 用户上传的视频
├── 1758506532219-813072359.xlsx   # 用户上传的文档
└── ...                            # 更多文件
```

### 数据库存储
```javascript
// 用户表
{
  name: "李昌轩",
  class: "测试班级",
  avatar: "avatar_url",
  userID: "unique_id",
  role: "super_admin"
}

// 作品表
{
  title: "我的艺术作品",
  content: "作品描述",
  author: "李昌轩",
  media: ["/uploads/file1.png", "/uploads/file2.mp4"],
  likes: 10,
  favorites: 5
}
```

## 🌐 部署后存储变化

### Render 部署
- **文件存储**: Render 服务器文件系统
- **数据库**: MongoDB Atlas（保持不变）
- **访问 URL**: `https://your-app.onrender.com/uploads/文件名`

### 存储优势
1. **文件持久化**: 重启服务不会丢失文件
2. **自动备份**: 云服务自动备份数据
3. **高可用性**: 99.9% 可用性保证
4. **扩展性**: 支持大量文件存储

## 🔧 存储配置

### 当前配置
```javascript
// 文件上传配置
const storage = multer.diskStorage({
  destination: (req, file, cb) => {
    cb(null, 'uploads');  // 存储到 uploads 目录
  },
  filename: (req, file, cb) => {
    const uniqueName = Date.now() + '-' + Math.round(Math.random() * 1E9) + path.extname(file.originalname);
    cb(null, uniqueName);  // 生成唯一文件名
  }
});

// 文件大小限制
limits: { fileSize: 100 * 1024 * 1024 }  // 100MB
```

### 静态文件服务
```javascript
// 提供文件访问服务
app.use('/uploads', express.static('uploads'));
```

## 📈 存储统计

### 当前文件统计
- **总文件数**: 60+ 个文件
- **文件类型**: 图片、视频、文档
- **存储大小**: 约 50MB
- **文件格式**: PNG, MP4, DOCX, TXT, XLSX

### 数据库统计
- **用户数**: 多个测试用户
- **作品数**: 27+ 个作品
- **数据大小**: 约 1MB
- **存储类型**: JSON 文档

## 🛡️ 数据安全

### 文件安全
- **唯一命名**: 防止文件名冲突
- **类型检查**: 支持多种文件类型
- **大小限制**: 防止过大文件上传
- **路径保护**: 防止目录遍历攻击

### 数据安全
- **MongoDB 加密**: 数据库连接加密
- **API 验证**: 请求参数验证
- **权限控制**: 用户角色管理
- **数据备份**: 定期数据备份

## 🔄 数据迁移

### 本地到云端
1. **文件迁移**: 上传到 Render 服务器
2. **数据库迁移**: 保持 MongoDB Atlas 连接
3. **配置更新**: 更新文件访问路径
4. **测试验证**: 确保所有功能正常

### 备份策略
- **文件备份**: 定期备份 uploads 目录
- **数据库备份**: MongoDB Atlas 自动备份
- **配置备份**: 保存环境变量配置
- **代码备份**: GitHub 版本控制

## 📝 使用建议

### 文件管理
- 定期清理无用文件
- 监控存储空间使用
- 设置文件大小限制
- 优化图片压缩

### 数据管理
- 定期备份重要数据
- 监控数据库性能
- 设置数据保留策略
- 优化查询性能

## 🆘 故障排除

### 文件访问问题
- 检查文件路径是否正确
- 确认文件权限设置
- 验证静态文件服务配置

### 数据库连接问题
- 检查 MongoDB 连接字符串
- 确认网络访问权限
- 验证环境变量配置

---

**总结**: 用户上传的文件存储在服务器文件系统中，用户个人数据存储在 MongoDB 数据库中，两者都支持持久化存储和云端部署。
