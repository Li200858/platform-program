<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="海淀外国语国际部艺术平台 - 展示学生艺术作品，分享创作灵感"
    />
    <meta name="keywords" content="艺术,作品,学生,创作,分享,海淀外国语" />
    <meta name="author" content="海淀外国语国际部" />
    <!-- Safari和微信浏览器兼容性修复 -->
    <meta name="format-detection" content="telephone=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="艺术平台" />
    <!-- 微信浏览器特定设置 -->
    <meta name="x5-orientation" content="portrait" />
    <meta name="x5-fullscreen" content="true" />
    <meta name="x5-page-mode" content="app" />
    <meta name="browsermode" content="application" />
    <meta name="x5-cache" content="false" />
    <!-- 防止微信浏览器缓存问题 -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>海淀外国语国际部艺术平台</title>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root">
      <!-- 加载提示，防止Safari中内容不显示 -->
      <div id="loading-fallback" style="
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        color: white;
        font-size: 18px;
        z-index: 9999;
        display: none;
      ">
        <div>正在加载艺术平台...</div>
        <div style="margin-top: 10px; font-size: 14px;">如果长时间无响应，请刷新页面</div>
      </div>
    </div>
    <script>
      // 微信浏览器和Safari兼容性检查和错误处理
      (function() {
        var loadingFallback = document.getElementById('loading-fallback');
        var root = document.getElementById('root');
        
        // 立即显示加载提示
        if (loadingFallback) {
          loadingFallback.style.display = 'block';
        }
        
        // 检测浏览器类型
        var userAgent = navigator.userAgent.toLowerCase();
        var isWeChat = /micromessenger/i.test(userAgent);
        var isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
        var isMobile = /mobile|android|iphone|ipad|phone/i.test(userAgent);
        
        console.log('浏览器检测:', {
          isWeChat: isWeChat,
          isSafari: isSafari,
          isMobile: isMobile,
          userAgent: userAgent
        });
        
        // 微信浏览器特定修复
        if (isWeChat) {
          // 微信浏览器需要特殊的CSS修复
          document.body.style.webkitTransform = 'translateZ(0)';
          document.body.style.transform = 'translateZ(0)';
          document.body.style.webkitBackfaceVisibility = 'hidden';
          document.body.style.backfaceVisibility = 'hidden';
          
          // 强制重绘
          document.body.offsetHeight;
        }
        
        // Safari特定修复
        if (isSafari) {
          document.body.style.webkitTransform = 'translateZ(0)';
          document.body.style.transform = 'translateZ(0)';
        }
        
        // 检查React应用是否加载成功
        var checkReactLoaded = function() {
          var reactRoot = document.querySelector('#root > div:not(#loading-fallback)');
          if (reactRoot && reactRoot.children.length > 0) {
            console.log('React应用已加载');
            if (loadingFallback) {
              loadingFallback.style.display = 'none';
            }
            return true;
          }
          return false;
        };
        
        // 立即检查一次
        if (!checkReactLoaded()) {
          // 如果React还没加载，每500ms检查一次
          var checkInterval = setInterval(function() {
            if (checkReactLoaded()) {
              clearInterval(checkInterval);
            }
          }, 500);
          
          // 10秒后强制隐藏加载提示
          setTimeout(function() {
            clearInterval(checkInterval);
            if (loadingFallback) {
              loadingFallback.style.display = 'none';
            }
          }, 10000);
        }
        
        // 错误处理
        window.addEventListener('error', function(e) {
          console.error('页面加载错误:', e);
          if (loadingFallback) {
            loadingFallback.innerHTML = '<div style="color: #e74c3c; font-weight: bold;">页面加载遇到问题</div><div style="margin-top: 10px; font-size: 14px;">错误: ' + (e.message || '未知错误') + '</div><div style="margin-top: 10px;"><button onclick="window.location.reload()" style="padding: 8px 16px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">刷新页面</button></div>';
          }
        });
        
        // 微信浏览器特殊处理
        if (isWeChat) {
          // 立即跳转到基础版本
          console.log('检测到微信浏览器，跳转到基础版本');
          window.location.href = '/wechat-basic.html';
        }
      })();
    </script>
    <!--
      This HTML file is a template.
      If you open it directly in the browser, you will see an empty page.

      You can add webfonts, meta tags, or analytics to this file.
      The build step will place the bundled scripts into the <body> tag.

      To begin the development, run `npm start` or `yarn start`.
      To create a production bundle, use `npm run build` or `yarn build`.
    -->
  </body>
</html>
