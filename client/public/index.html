<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, shrink-to-fit=no" />
    <meta name="theme-color" content="#667eea" />
    <meta
      name="description"
      content="海淀外国语国际部艺术平台 - 展示学生艺术作品，分享创作灵感"
    />
    <meta name="keywords" content="艺术,作品,学生,创作,分享,海淀外国语" />
    <meta name="author" content="海淀外国语国际部" />
    
    <!-- 移动端Safari兼容性优化 -->
    <meta name="format-detection" content="telephone=no, email=no, address=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="艺术平台" />
    <meta name="apple-touch-fullscreen" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />
    
    <!-- 微信浏览器兼容性 -->
    <meta name="x5-orientation" content="portrait" />
    <meta name="x5-fullscreen" content="true" />
    <meta name="x5-page-mode" content="app" />
    <meta name="browsermode" content="application" />
    <meta name="x5-cache" content="false" />
    
    <!-- 防止缓存问题 -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    
    <!-- 移动端Safari特殊优化 -->
    <meta name="apple-mobile-web-app-status-bar-inset" content="no" />
    <meta name="apple-mobile-web-app-orientations" content="portrait" />
    <title>海淀外国语国际部艺术平台</title>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root">
      <!-- 加载提示，防止Safari中内容不显示 -->
      <div id="loading-fallback" style="
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        color: white;
        font-size: 18px;
        z-index: 9999;
        display: none;
      ">
        <div>正在加载艺术平台...</div>
        <div style="margin-top: 10px; font-size: 14px;">如果长时间无响应，请刷新页面</div>
      </div>
    </div>
    <script>
      // 移动端Safari和微信浏览器兼容性优化
      (function() {
        var loadingFallback = document.getElementById('loading-fallback');
        var root = document.getElementById('root');
        
        // 检测浏览器类型
        var userAgent = navigator.userAgent.toLowerCase();
        var isWeChat = /micromessenger/i.test(userAgent);
        var isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
        var isMobile = /mobile|android|iphone|ipad|phone/i.test(userAgent);
        var isIOS = /iphone|ipad|ipod/i.test(userAgent);
        var isIPad = /ipad/i.test(userAgent) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
        
        // 强制显示内容，防止iPad Safari空白问题
        function forceContentDisplay() {
          if (root) {
            root.style.display = 'block';
            root.style.visibility = 'visible';
            root.style.opacity = '1';
            root.style.position = 'relative';
            root.style.zIndex = '1';
            root.style.minHeight = '100vh';
            root.style.width = '100%';
            root.style.webkitTransform = 'translate3d(0, 0, 0)';
            root.style.transform = 'translate3d(0, 0, 0)';
            root.style.webkitBackfaceVisibility = 'hidden';
            root.style.backfaceVisibility = 'hidden';
            root.style.willChange = 'transform';
            root.offsetHeight; // 强制重排
          }
        }
        
        // 立即执行
        forceContentDisplay();
        
        console.log('浏览器检测:', {
          isWeChat: isWeChat,
          isSafari: isSafari,
          isMobile: isMobile,
          isIOS: isIOS,
          isIPad: isIPad,
          userAgent: userAgent
        });
        
        // 立即显示加载提示
        if (loadingFallback) {
          loadingFallback.style.display = 'block';
        }
        
        // 移动端Safari和iOS设备特殊修复
        if (isIOS || isIPad || (isSafari && isMobile)) {
          console.log('检测到iOS设备、iPad或移动端Safari，应用特殊修复');
          
          // 强制硬件加速
          document.body.style.webkitTransform = 'translateZ(0)';
          document.body.style.transform = 'translateZ(0)';
          document.body.style.webkitBackfaceVisibility = 'hidden';
          document.body.style.backfaceVisibility = 'hidden';
          document.body.style.webkitPerspective = '1000px';
          document.body.style.perspective = '1000px';
          
          // 确保root元素可见
          if (root) {
            root.style.webkitTransform = 'translateZ(0)';
            root.style.transform = 'translateZ(0)';
            root.style.webkitBackfaceVisibility = 'hidden';
            root.style.backfaceVisibility = 'hidden';
            root.style.position = 'relative';
            root.style.zIndex = '1';
            root.style.minHeight = '100vh';
            root.style.display = 'block';
            root.style.visibility = 'visible';
            root.style.opacity = '1';
          }
          
          // iPad Safari特殊修复
          if (isIPad) {
            console.log('应用iPad Safari特殊修复');
            
            // 强制重绘，解决iPad Safari渲染问题
            setTimeout(function() {
              if (root) {
                root.style.webkitTransform = 'translate3d(0, 0, 0)';
                root.style.transform = 'translate3d(0, 0, 0)';
                root.style.webkitBackfaceVisibility = 'hidden';
                root.style.backfaceVisibility = 'hidden';
                root.style.webkitPerspective = '1000px';
                root.style.perspective = '1000px';
                root.style.willChange = 'transform';
                root.style.position = 'relative';
                root.style.zIndex = '2';
                root.style.minHeight = '100vh';
                root.style.width = '100%';
                root.style.display = 'block';
                root.style.visibility = 'visible';
                root.style.opacity = '1';
                
                // 强制重排
                root.offsetHeight;
              }
            }, 100);
            
            // 延迟再次修复，确保React组件完全加载
            setTimeout(function() {
              if (root) {
                root.style.webkitTransform = 'translate3d(0, 0, 0)';
                root.style.transform = 'translate3d(0, 0, 0)';
                root.offsetHeight;
              }
            }, 1000);
          }
          
          // 防止iOS Safari的缩放问题
          document.addEventListener('touchstart', function(e) {
            if (e.touches.length > 1) {
              e.preventDefault();
            }
          }, { passive: false });
          
          // 防止iOS Safari的滚动问题
          document.addEventListener('touchmove', function(e) {
            if (e.touches.length > 1) {
              e.preventDefault();
            }
          }, { passive: false });
        }
        
        // 微信浏览器特殊修复
        if (isWeChat) {
          console.log('检测到微信浏览器，应用特殊修复');
          
          // 微信浏览器需要特殊的CSS修复
          document.body.style.webkitTransform = 'translateZ(0)';
          document.body.style.transform = 'translateZ(0)';
          document.body.style.webkitBackfaceVisibility = 'hidden';
          document.body.style.backfaceVisibility = 'hidden';
          
          // 强制重绘
          document.body.offsetHeight;
        }
        
        // 检查React应用是否加载成功
        var checkReactLoaded = function() {
          var reactRoot = document.querySelector('#root > div:not(#loading-fallback)');
          if (reactRoot && reactRoot.children.length > 0) {
            console.log('React应用已加载');
            if (loadingFallback) {
              loadingFallback.style.display = 'none';
            }
            // iPad Safari特殊处理：强制显示内容
            if (isIPad) {
              forceContentDisplay();
            }
            return true;
          }
          
          // 额外检查：如果root元素有内容，也认为加载成功
          var rootElement = document.getElementById('root');
          if (rootElement && rootElement.innerHTML.trim() !== '') {
            console.log('React应用已加载（通过内容检查）');
            if (loadingFallback) {
              loadingFallback.style.display = 'none';
            }
            // iPad Safari特殊处理：强制显示内容
            if (isIPad) {
              forceContentDisplay();
            }
            return true;
          }
          
          return false;
        };
        
        // iPad Safari特殊处理：立即显示内容
        if (isIPad) {
          console.log('iPad Safari检测到，应用激进修复');
          
          // 立即显示内容，不等待React加载
          setTimeout(function() {
            forceContentDisplay();
            if (loadingFallback) {
              loadingFallback.style.display = 'none';
            }
          }, 100);
          
          // 多次强制显示，确保内容可见
          setTimeout(forceContentDisplay, 500);
          setTimeout(forceContentDisplay, 1000);
          setTimeout(forceContentDisplay, 2000);
          setTimeout(forceContentDisplay, 3000);
        }
        
        // 立即检查一次
        if (!checkReactLoaded()) {
          // 如果React还没加载，每500ms检查一次
          var checkInterval = setInterval(function() {
            if (checkReactLoaded()) {
              clearInterval(checkInterval);
            }
          }, 500);
          
          // 8秒后强制隐藏加载提示
          setTimeout(function() {
            clearInterval(checkInterval);
            if (loadingFallback) {
              loadingFallback.style.display = 'none';
            }
            // iPad Safari最后尝试
            if (isIPad) {
              forceContentDisplay();
            }
          }, 8000);
        }
        
        // 错误处理
        window.addEventListener('error', function(e) {
          console.error('页面加载错误:', e);
          if (loadingFallback) {
            loadingFallback.innerHTML = '<div style="color: #e74c3c; font-weight: bold;">页面加载遇到问题</div><div style="margin-top: 10px; font-size: 14px;">错误: ' + (e.message || '未知错误') + '</div><div style="margin-top: 10px;"><button onclick="window.location.reload()" style="padding: 8px 16px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">刷新页面</button></div>';
          }
        });
        
        // 页面可见性变化处理
        document.addEventListener('visibilitychange', function() {
          if (!document.hidden) {
            // 页面重新可见时，强制重绘
            if (root) {
              root.style.webkitTransform = 'translateZ(0)';
              root.style.transform = 'translateZ(0)';
            }
          }
        });
        
        // 窗口大小变化处理
        window.addEventListener('resize', function() {
          // 强制重绘，确保内容在Safari中正确显示
          if (root) {
            root.style.webkitTransform = 'translateZ(0)';
            root.style.transform = 'translateZ(0)';
          }
        });
        
      })();
    </script>
    <!--
      This HTML file is a template.
      If you open it directly in the browser, you will see an empty page.

      You can add webfonts, meta tags, or analytics to this file.
      The build step will place the bundled scripts into the <body> tag.

      To begin the development, run `npm start` or `yarn start`.
      To create a production bundle, use `npm run build` or `yarn build`.
    -->
  </body>
</html>
