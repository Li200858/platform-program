<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <meta name="x5-orientation" content="portrait">
    <meta name="x5-fullscreen" content="true">
    <meta name="x5-page-mode" content="app">
    <meta name="browsermode" content="application">
    <meta name="x5-cache" content="false">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>è‰ºæœ¯å¹³å° - å¾®ä¿¡ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
            background: #667eea;
            background: -webkit-linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            line-height: 1.6;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 14px;
            opacity: 0.8;
        }
        
        .status {
            background: rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .status.loading {
            background: rgba(52, 152, 219, 0.3);
        }
        
        .status.error {
            background: rgba(231, 76, 60, 0.3);
        }
        
        .status.success {
            background: rgba(39, 174, 96, 0.3);
        }
        
        .button {
            display: inline-block;
            padding: 12px 24px;
            background: #3498db;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            margin: 5px;
            font-size: 16px;
            border: none;
            cursor: pointer;
            -webkit-appearance: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        .button:hover {
            background: #2980b9;
        }
        
        .button:active {
            background: #21618c;
        }
        
        .button.success {
            background: #27ae60;
        }
        
        .button.error {
            background: #e74c3c;
        }
        
        .info {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 14px;
        }
        
        .info strong {
            display: block;
            margin-bottom: 5px;
        }
        
        .hidden {
            display: none;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .debug {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            margin-top: 10px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¨ æµ·æ·€å¤–å›½è¯­å›½é™…éƒ¨è‰ºæœ¯å¹³å°</h1>
            <p>HFLS International Art Platform</p>
        </div>
        
        <div id="status" class="status loading">
            <div class="loading-spinner"></div>
            <div>æ­£åœ¨æ£€æµ‹å¾®ä¿¡æµè§ˆå™¨å…¼å®¹æ€§...</div>
        </div>
        
        <div id="browser-info" class="info hidden">
            <strong>æµè§ˆå™¨ä¿¡æ¯ï¼š</strong>
            <div id="browser-details"></div>
        </div>
        
        <div id="test-results" class="info hidden">
            <strong>å…¼å®¹æ€§æµ‹è¯•ï¼š</strong>
            <div id="test-details"></div>
        </div>
        
        <div id="actions" class="hidden">
            <button class="button" onclick="loadMainApp()">ğŸ  è¿›å…¥ä¸»åº”ç”¨</button>
            <button class="button" onclick="refreshPage()">ğŸ”„ åˆ·æ–°é¡µé¢</button>
            <button class="button" onclick="showDebug()">ğŸ” æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯</button>
        </div>
        
        <div id="debug-info" class="debug hidden"></div>
    </div>

    <script>
        // å¾®ä¿¡æµè§ˆå™¨æ£€æµ‹å’Œå…¼å®¹æ€§ä¿®å¤
        (function() {
            var status = document.getElementById('status');
            var browserInfo = document.getElementById('browser-info');
            var testResults = document.getElementById('test-results');
            var actions = document.getElementById('actions');
            var debugInfo = document.getElementById('debug-info');
            
            var userAgent = navigator.userAgent;
            var isWeChat = /micromessenger/i.test(userAgent);
            var isMobile = /mobile|android|iphone|ipad|phone/i.test(userAgent);
            var isIOS = /iphone|ipad|ipod/i.test(userAgent);
            var isAndroid = /android/i.test(userAgent);
            
            var debugData = {
                userAgent: userAgent,
                isWeChat: isWeChat,
                isMobile: isMobile,
                isIOS: isIOS,
                isAndroid: isAndroid,
                screenWidth: window.innerWidth,
                screenHeight: window.innerHeight,
                devicePixelRatio: window.devicePixelRatio || 1,
                timestamp: new Date().toISOString()
            };
            
            function updateStatus(message, type) {
                status.className = 'status ' + type;
                status.innerHTML = '<div>' + message + '</div>';
            }
            
            function showBrowserInfo() {
                browserInfo.className = 'info';
                document.getElementById('browser-details').innerHTML = 
                    'å¾®ä¿¡æµè§ˆå™¨: ' + (isWeChat ? 'æ˜¯' : 'å¦') + '<br>' +
                    'ç§»åŠ¨è®¾å¤‡: ' + (isMobile ? 'æ˜¯' : 'å¦') + '<br>' +
                    'æ“ä½œç³»ç»Ÿ: ' + (isIOS ? 'iOS' : isAndroid ? 'Android' : 'å…¶ä»–') + '<br>' +
                    'å±å¹•å°ºå¯¸: ' + window.innerWidth + 'x' + window.innerHeight + '<br>' +
                    'è®¾å¤‡åƒç´ æ¯”: ' + (window.devicePixelRatio || 1);
            }
            
            function runCompatibilityTests() {
                var tests = [];
                
                // æµ‹è¯•1: JavaScriptåŸºæœ¬åŠŸèƒ½
                try {
                    var testObj = { test: 'value' };
                    var testArray = [1, 2, 3];
                    if (testObj.test === 'value' && testArray.length === 3) {
                        tests.push('âœ“ JavaScriptåŸºæœ¬åŠŸèƒ½æ­£å¸¸');
                    } else {
                        tests.push('âœ— JavaScriptåŸºæœ¬åŠŸèƒ½å¼‚å¸¸');
                    }
                } catch (e) {
                    tests.push('âœ— JavaScripté”™è¯¯: ' + e.message);
                }
                
                // æµ‹è¯•2: DOMæ“ä½œ
                try {
                    var testDiv = document.createElement('div');
                    testDiv.id = 'test-dom';
                    document.body.appendChild(testDiv);
                    var foundDiv = document.getElementById('test-dom');
                    if (foundDiv) {
                        tests.push('âœ“ DOMæ“ä½œæ­£å¸¸');
                        document.body.removeChild(foundDiv);
                    } else {
                        tests.push('âœ— DOMæ“ä½œå¼‚å¸¸');
                    }
                } catch (e) {
                    tests.push('âœ— DOMæ“ä½œé”™è¯¯: ' + e.message);
                }
                
                // æµ‹è¯•3: CSSæ¸å˜æ”¯æŒ
                try {
                    var testDiv = document.createElement('div');
                    testDiv.style.background = 'linear-gradient(45deg, #ff0000, #0000ff)';
                    testDiv.style.position = 'absolute';
                    testDiv.style.left = '-100px';
                    testDiv.style.top = '-100px';
                    testDiv.style.width = '50px';
                    testDiv.style.height = '50px';
                    document.body.appendChild(testDiv);
                    
                    var computedStyle = window.getComputedStyle(testDiv);
                    var background = computedStyle.background || computedStyle.backgroundImage;
                    
                    if (background && background.indexOf('gradient') !== -1) {
                        tests.push('âœ“ CSSæ¸å˜æ”¯æŒæ­£å¸¸');
                    } else {
                        tests.push('âš  CSSæ¸å˜æ”¯æŒæœ‰é™');
                    }
                    
                    document.body.removeChild(testDiv);
                } catch (e) {
                    tests.push('âœ— CSSæ¸å˜æµ‹è¯•é”™è¯¯: ' + e.message);
                }
                
                // æµ‹è¯•4: è§¦æ‘¸æ”¯æŒ
                if ('ontouchstart' in window || navigator.maxTouchPoints > 0) {
                    tests.push('âœ“ è§¦æ‘¸äº‹ä»¶æ”¯æŒ');
                } else {
                    tests.push('âš  è§¦æ‘¸äº‹ä»¶ä¸æ”¯æŒ');
                }
                
                // æµ‹è¯•5: è§†å£æ”¯æŒ
                if (window.innerWidth > 0 && window.innerHeight > 0) {
                    tests.push('âœ“ è§†å£å°ºå¯¸æ­£å¸¸');
                } else {
                    tests.push('âœ— è§†å£å°ºå¯¸å¼‚å¸¸');
                }
                
                return tests;
            }
            
            function showTestResults() {
                var tests = runCompatibilityTests();
                testResults.className = 'info';
                document.getElementById('test-details').innerHTML = tests.join('<br>');
                
                // è®¡ç®—é€šè¿‡ç‡
                var passedTests = tests.filter(function(test) {
                    return test.indexOf('âœ“') === 0;
                }).length;
                var totalTests = tests.length;
                var passRate = Math.round((passedTests / totalTests) * 100);
                
                debugData.testResults = tests;
                debugData.passRate = passRate;
                
                return passRate;
            }
            
            function showActions() {
                actions.className = '';
            }
            
            function showDebug() {
                debugInfo.className = 'debug';
                debugInfo.textContent = JSON.stringify(debugData, null, 2);
            }
            
            function loadMainApp() {
                updateStatus('æ­£åœ¨åŠ è½½ä¸»åº”ç”¨...', 'loading');
                
                // å°è¯•åŠ è½½ä¸»åº”ç”¨
                var iframe = document.createElement('iframe');
                iframe.src = '/';
                iframe.style.width = '100%';
                iframe.style.height = '600px';
                iframe.style.border = 'none';
                iframe.style.borderRadius = '10px';
                
                iframe.onload = function() {
                    updateStatus('ä¸»åº”ç”¨åŠ è½½æˆåŠŸï¼', 'success');
                    showActions();
                };
                
                iframe.onerror = function() {
                    updateStatus('ä¸»åº”ç”¨åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', 'error');
                    showActions();
                };
                
                // æ›¿æ¢å½“å‰å†…å®¹
                document.body.innerHTML = '';
                document.body.appendChild(iframe);
            }
            
            function refreshPage() {
                window.location.reload();
            }
            
            // ä¸»æ‰§è¡Œæµç¨‹
            function init() {
                console.log('å¾®ä¿¡æµè§ˆå™¨å…¼å®¹æ€§æ£€æµ‹å¼€å§‹...');
                
                // æ˜¾ç¤ºæµè§ˆå™¨ä¿¡æ¯
                showBrowserInfo();
                
                // è¿è¡Œå…¼å®¹æ€§æµ‹è¯•
                var passRate = showTestResults();
                
                // æ ¹æ®æµ‹è¯•ç»“æœå†³å®šä¸‹ä¸€æ­¥
                if (passRate >= 80) {
                    updateStatus('å…¼å®¹æ€§æ£€æµ‹é€šè¿‡ï¼å¯ä»¥æ­£å¸¸ä½¿ç”¨', 'success');
                    showActions();
                } else if (passRate >= 60) {
                    updateStatus('å…¼å®¹æ€§ä¸€èˆ¬ï¼Œå»ºè®®åˆ·æ–°åé‡è¯•', 'error');
                    showActions();
                } else {
                    updateStatus('å…¼å®¹æ€§è¾ƒå·®ï¼Œå¯èƒ½éœ€è¦æ›´æ–°å¾®ä¿¡ç‰ˆæœ¬', 'error');
                    showActions();
                }
                
                // å¾®ä¿¡æµè§ˆå™¨ç‰¹æ®Šå¤„ç†
                if (isWeChat) {
                    console.log('æ£€æµ‹åˆ°å¾®ä¿¡æµè§ˆå™¨ï¼Œåº”ç”¨ç‰¹æ®Šä¿®å¤...');
                    
                    // å¼ºåˆ¶é‡ç»˜
                    document.body.style.webkitTransform = 'translateZ(0)';
                    document.body.style.transform = 'translateZ(0)';
                    document.body.style.webkitBackfaceVisibility = 'hidden';
                    document.body.style.backfaceVisibility = 'hidden';
                    
                    // é˜²æ­¢å¾®ä¿¡æµè§ˆå™¨ç¼“å­˜é—®é¢˜
                    if (window.location.search.indexOf('t=') === -1) {
                        var newUrl = window.location.href + (window.location.search ? '&' : '?') + 't=' + Date.now();
                        window.history.replaceState({}, '', newUrl);
                    }
                }
            }
            
            // é”™è¯¯å¤„ç†
            window.addEventListener('error', function(e) {
                console.error('é¡µé¢é”™è¯¯:', e);
                updateStatus('é¡µé¢å‘ç”Ÿé”™è¯¯: ' + e.message, 'error');
                showActions();
            });
            
            // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', init);
            } else {
                init();
            }
            
            // æš´éœ²å…¨å±€å‡½æ•°
            window.loadMainApp = loadMainApp;
            window.refreshPage = refreshPage;
            window.showDebug = showDebug;
            
        })();
    </script>
</body>
</html>
